<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:generic="clr-namespace:System.Collections.Generic;assembly=System.Collections"
        xmlns:sections="clr-namespace:Zafiro.UI.Navigation.Sections;assembly=Zafiro.UI"
        xmlns:controls="clr-namespace:Zafiro.Avalonia.Controls"
        xmlns:conv="clr-namespace:Zafiro.Avalonia.Converters"
        x:CompileBindings="True">
    <Design.PreviewWith>
        <StackPanel Spacing="20" Height="400">
            <SectionStrip Orientation="Horizontal" Width="300" MaxItemWidth="100" IconSize="10">
                <SectionStrip.Sections>
                    <generic:List x:TypeArguments="sections:ISection">
                        <ContentSectionDesign Name="Section1" IsVisible="False" FriendlyName="Section 1" Icon="{Icon fa-wallet}" />
                        <ContentSectionDesign Name="Section2" FriendlyName="Section Wider" Icon="{Icon fa-wallet}" />
                        <ContentSectionDesign Name="Section3" FriendlyName="Section 3" Icon="{Icon fa-wallet}" />
                        <ContentSectionDesign Name="Section4" FriendlyName="Section Much Wider" Icon="{Icon fa-wallet}" />
                        <ContentSectionDesign Name="Section5" FriendlyName="Section 5" Icon="{Icon fa-wallet}" />
                    </generic:List>
                </SectionStrip.Sections>
            </SectionStrip>
            <SectionStrip Orientation="Vertical" Height="300" MaxItemWidth="100" IconSize="10">
                <SectionStrip.Sections>
                    <generic:List x:TypeArguments="sections:ISection">
                        <ContentSectionDesign Name="Section1" FriendlyName="Section 1" Icon="{Icon fa-wallet}" />
                        <ContentSectionDesign Name="Section2" IsVisible="False" FriendlyName="Section 2" Icon="{Icon fa-wallet}" />
                        <ContentSectionDesign Name="Section3" FriendlyName="Section 3" Icon="{Icon fa-wallet}" />
                        <ContentSectionDesign Name="Section4" FriendlyName="Section 4" Icon="{Icon fa-wallet}" />
                        <ContentSectionDesign Name="Section5" FriendlyName="Section 5" Icon="{Icon fa-wallet}" />
                    </generic:List>
                </SectionStrip.Sections>
            </SectionStrip>
        </StackPanel>
    </Design.PreviewWith>

    <Styles.Resources>

        <conv:StringNotNullOrWhiteSpaceConverter x:Key="StringNotNullOrWhiteSpaceConverter" />

        <!-- Default theme for SectionStripItem - can be customized via SectionStrip.ItemContainerTheme or Style selectors -->
        <ControlTheme x:Key="{x:Type controls:SectionStripItem}" TargetType="controls:SectionStripItem">
            <Setter Property="Padding" Value="0" />
            <Setter Property="Focusable" Value="False" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            Padding="{TemplateBinding Padding}">
                        <ContentPresenter x:Name="PART_ContentPresenter"
                                          Content="{TemplateBinding Content}"
                                          ContentTemplate="{TemplateBinding ContentTemplate}"
                                          HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                          VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" />
                    </Border>
                </ControlTemplate>
            </Setter>

            <Style Selector="^:pointerover">
                <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListLowBrush}" />
            </Style>

            <Style Selector="^:selected">
                <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListAccentLowBrush}" />
            </Style>

            <Style Selector="^:selected:pointerover">
                <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListAccentMediumBrush}" />
            </Style>

            <Style Selector="^:pressed">
                <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListMediumBrush}" />
            </Style>
        </ControlTheme>

        <!-- Default theme for SectionStripGroupHeader - can be customized via Style selectors -->
        <ControlTheme x:Key="{x:Type controls:SectionStripGroupHeader}" TargetType="controls:SectionStripGroupHeader">
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Margin" Value="0,0,0,4" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            Padding="{TemplateBinding Padding}">
                        <ContentPresenter x:Name="PART_HeaderPresenter"
                                          Content="{TemplateBinding Header}"
                                          ContentTemplate="{TemplateBinding HeaderTemplate}"
                                          HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                          VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" />
                    </Border>
                </ControlTemplate>
            </Setter>
        </ControlTheme>

        <!-- SectionStripListBox inherits ListBox theme -->
        <ControlTheme x:Key="{x:Type controls:SectionStripListBox}" TargetType="controls:SectionStripListBox"
                      BasedOn="{StaticResource {x:Type ListBox}}" />

        <DataTemplate x:Key="VerticalItem" DataType="sections:ISection">
            <Grid Margin="{Binding $parent[SectionStrip].ItemPadding}" ColumnSpacing="{Binding $parent[SectionStrip].HorizontalIconLabelSpacing}"
                  RowSpacing="{Binding $parent[SectionStrip].VerticalIconLabelSpacing}" x:Name="SectionGrid">
                <Grid.RowDefinitions>
                    <RowDefinition SharedSizeGroup="Icon" Height="Auto" />
                    <RowDefinition SharedSizeGroup="Label" Height="Auto" />
                </Grid.RowDefinitions>
                <Viewbox Grid.Row="0" Height="{Binding $parent[SectionStrip].IconSize}" Width="{Binding $self.Width}" DockPanel.Dock="Top">
                    <ContentControl Margin="{Binding $parent[SectionStrip].IconMargin}" Content="{Binding Icon}" />
                </Viewbox>
                <TextBlock Grid.Row="1" DockPanel.Dock="Bottom"
                           TextAlignment="Center" TextWrapping="Wrap"
                           HorizontalAlignment="Center" TextTrimming="{x:Static TextTrimming.CharacterEllipsis}" Text="{Binding FriendlyName}" />
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="HorizontalItem" DataType="sections:ISection">
            <DockPanel Margin="{Binding $parent[SectionStrip].ItemPadding}" HorizontalSpacing="{Binding $parent[SectionStrip].HorizontalIconLabelSpacing}">
                <Viewbox Height="{Binding $parent[SectionStrip].IconSize}" Width="{Binding $self.Width}">
                    <ContentControl Margin="{Binding $parent[SectionStrip].IconMargin}" Content="{Binding Icon}" />
                </Viewbox>
                <TextBlock VerticalAlignment="Center" TextTrimming="{x:Static TextTrimming.CharacterEllipsis}" Text="{Binding FriendlyName}" />
            </DockPanel>
        </DataTemplate>

        <DataTemplate x:Key="SectionGroupTemplate" DataType="controls:SectionGroupView">
            <StackPanel Spacing="6">
                <controls:SectionStripGroupHeader
                    Header="{Binding Group.FriendlyName}"
                    IsVisible="{Binding Group.FriendlyName, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}" />
                <controls:SectionStripListBox Background="Transparent"
                         ItemContainerTheme="{Binding $parent[SectionStrip].ItemContainerTheme, TargetNullValue={StaticResource {x:Type controls:SectionStripItem}}}"
                         SelectedValue="{Binding $parent[SectionStrip].SelectedSection, Mode=TwoWay}"
                         ItemsSource="{Binding Sections}"
                         ItemTemplate="{Binding $parent[SectionStrip].ItemTemplate, TargetNullValue={StaticResource HorizontalItem}}" />
            </StackPanel>
        </DataTemplate>

        <ControlTheme x:Key="{x:Type SectionStrip}" TargetType="SectionStrip">
            <Setter Property="HorizontalIconLabelSpacing" Value="10" />
            <Setter Property="VerticalIconLabelSpacing" Value="4" />
            <Setter Property="ItemPadding" Value="5" />
            <Setter Property="Padding" Value="10"></Setter>
            <Style Selector="^ /template/ ListBox">
                <Setter Property="Background" Value="Transparent" />
            </Style>
            <Style Selector="^ /template/ Button">
                <Setter Property="Background" Value="Transparent" />
            </Style>
            <Style Selector="^[Orientation=Vertical]">
                <Setter Property="Template">
                    <ControlTemplate>
                        <ScrollViewer>
                            <ItemsControl Padding="{TemplateBinding Padding}" ItemsSource="{TemplateBinding SectionGroups}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Spacing="{Binding $parent[SectionStrip].ItemSpacing}" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <StaticResource ResourceKey="SectionGroupTemplate" />
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </ControlTemplate>
                </Setter>
            </Style>
            <Style Selector="^[Orientation=Horizontal]">
                <Setter Property="Template">
                    <ControlTemplate>
                        <DockPanel>
                            <EnhancedButton VerticalAlignment="Stretch" x:Name="Button" IsVisible="{Binding !!#VisibilityExposerBehavior.InvisibleItems.Count}"
                                            DockPanel.Dock="Right" HorizontalAlignment="Right" Content="...">
                                <Button.Flyout>
                                    <Flyout>
                                        <controls:SectionStripListBox x:Name="OtherSections" SelectedItem="{TemplateBinding SelectedSection, Mode=TwoWay}"
                                                 ItemContainerTheme="{Binding ItemContainerTheme, RelativeSource={RelativeSource TemplatedParent}, TargetNullValue={StaticResource {x:Type controls:SectionStripItem}}}"
                                                 ItemTemplate="{Binding ItemTemplate, RelativeSource={RelativeSource TemplatedParent}, TargetNullValue={StaticResource VerticalItem}}"
                                                 ItemsSource="{Binding #VisibilityExposerBehavior.InvisibleItems}" />
                                    </Flyout>
                                </Button.Flyout>
                                <Interaction.Behaviors>
                                    <EventTriggerBehavior SourceObject="OtherSections" EventName="SelectionChanged">
                                        <HideFlyoutAction Flyout="{Binding #Button.Flyout}" />
                                    </EventTriggerBehavior>
                                </Interaction.Behaviors>
                            </EnhancedButton>
                            <controls:SectionStripListBox ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                     Background="{TemplateBinding Background}"
                                     ItemContainerTheme="{Binding ItemContainerTheme, RelativeSource={RelativeSource TemplatedParent}, TargetNullValue={StaticResource {x:Type controls:SectionStripItem}}}"
                                     ItemTemplate="{Binding ItemTemplate, RelativeSource={RelativeSource TemplatedParent}, TargetNullValue={StaticResource VerticalItem}}"
                                     SelectedItem="{TemplateBinding SelectedSection, Mode=TwoWay}"
                                     ItemsSource="{TemplateBinding FilteredSections}">
                                <controls:SectionStripListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformStripPanel
                                            Grid.IsSharedSizeScope="True"
                                            ItemSpacing="{Binding $parent[SectionStrip].ItemSpacing}"
                                            ItemMinWidth="{Binding $parent[SectionStrip].MinItemWidth}"
                                            ItemMaxWidth="{Binding $parent[SectionStrip].MaxItemWidth}" />
                                    </ItemsPanelTemplate>
                                </controls:SectionStripListBox.ItemsPanel>
                                <Interaction.Behaviors>
                                    <ItemVisibilityMonitoringBehavior x:Name="VisibilityExposerBehavior" />
                                </Interaction.Behaviors>
                            </controls:SectionStripListBox>
                        </DockPanel>
                    </ControlTemplate>
                </Setter>
            </Style>

        </ControlTheme>
    </Styles.Resources>
</Styles>