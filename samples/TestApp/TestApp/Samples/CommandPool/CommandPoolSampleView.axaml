<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:commandPool="clr-namespace:TestApp.Samples.CommandPool"
             xmlns:controls="clr-namespace:Zafiro.Avalonia.Controls;assembly=Zafiro.Avalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="TestApp.Samples.CommandPool.CommandPoolSampleView"
             x:DataType="commandPool:CommandPoolSampleViewModel">

    <UserControl.Resources>
        <controls:CommandPoolMonitor x:Key="PoolObserver" PoolName="SamplePool" />
    </UserControl.Resources>

    <!-- behaviors alias removed as it's no longer needed for behaviors, but we need controls -->

    <Grid RowDefinitions="Auto, Auto, *">

        <StackPanel Spacing="10" Margin="10">
            <TextBlock Classes="H1" Text="Command Pool Sample" />
            <TextBlock Text="This sample demonstrates the progress tracking capabilities of CommandPool." />

            <Border Classes="Card" Theme="{StaticResource Card}">
                <StackPanel Spacing="5">
                    <TextBlock Classes="H3" Text="Pool Statistics" />
                    <Grid ColumnDefinitions="Auto, 10, Auto, 10, Auto, 10, Auto" RowDefinitions="Auto, Auto">
                        <TextBlock Grid.Column="0" Text="Total:" FontWeight="Bold" />
                        <TextBlock Grid.Column="0" Grid.Row="1" Text="{Binding TotalCount^, Source={StaticResource PoolObserver}}" />

                        <TextBlock Grid.Column="2" Text="Pending:" FontWeight="Bold" />
                        <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding PendingCount^, Source={StaticResource PoolObserver}}" />

                        <TextBlock Grid.Column="4" Text="Executing:" FontWeight="Bold" />
                        <TextBlock Grid.Column="4" Grid.Row="1" Text="{Binding ExecutingCount^, Source={StaticResource PoolObserver}}" />

                        <TextBlock Grid.Column="6" Text="Completed:" FontWeight="Bold" />
                        <TextBlock Grid.Column="6" Grid.Row="1" Text="{Binding CompletedCount^, Source={StaticResource PoolObserver}}" />
                    </Grid>

                    <ProgressBar Maximum="{Binding TotalCount^, Source={StaticResource PoolObserver}}"
                                 Value="{Binding CompletedCount^, Source={StaticResource PoolObserver}}"
                                 Height="10" />

                    <TextBlock Text="{Binding IsExecuting^, Source={StaticResource PoolObserver}, StringFormat='Is Executing: {0}'}" />
                </StackPanel>
            </Border>

            <Button Command="{Binding StartAll}" Content="Start All Jobs" />
        </StackPanel>

        <ScrollViewer Grid.Row="2">
            <ItemsControl ItemsSource="{Binding Jobs}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="10" Margin="5" Background="#20808080" CornerRadius="5">
                            <Grid ColumnDefinitions="*, Auto">
                                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" />
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Exec" IsVisible="{Binding IsExecuting}" VerticalAlignment="Center" Foreground="Green" />
                                    <Button Content="Run">
                                        <Interaction.Behaviors>
                                            <EventTriggerBehavior EventName="Click">
                                                <EnqueueCommandAction Command="{Binding Work}"
                                                                      PoolName="SamplePool"
                                                                      x:Name="CommandAction"
                                                                      MaxConcurrency="3"
                                                                      DelayBetweenSeconds="0.2" />
                                            </EventTriggerBehavior>
                                        </Interaction.Behaviors>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>